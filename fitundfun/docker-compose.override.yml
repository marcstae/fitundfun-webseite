services:
  web:
    container_name: fitundfun-web
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # Server (SSR) verwendet kong (Docker-Netzwerk)
      - SUPABASE_URL=http://kong:8000
      - SUPABASE_ANON_KEY=${ANON_KEY}
      # Client (Browser) verwendet localhost
      - SUPABASE_CLIENT_URL=http://localhost:8000
      - NUXT_PUBLIC_SUPABASE_URL=http://localhost:8000
      - NUXT_PUBLIC_SUPABASE_CLIENT_URL=http://localhost:8000
      - NUXT_PUBLIC_SUPABASE_KEY=${ANON_KEY}
      # Service Role Key f√ºr Admin-Operationen (Backup/Restore)
      - SUPABASE_SERVICE_KEY=${SERVICE_ROLE_KEY}
      - SUPABASE_SECRET_KEY=${SERVICE_ROLE_KEY}
      - NODE_ENV=production
    extra_hosts:
      - "localhost:host-gateway"
    depends_on:
      kong:
        condition: service_started

  # Override Storage um Docker Volume zu verwenden (macOS xattr Problem)
  storage:
    volumes:
      - storage-data:/var/lib/storage

  imgproxy:
    volumes:
      - storage-data:/var/lib/storage

volumes:
  storage-data: